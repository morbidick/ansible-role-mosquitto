# Mosquitto

Master: [![Build Status](https://travis-ci.org/sansible/mosquitto.svg?branch=master)](https://travis-ci.org/sansible/mosquitto)
Develop: [![Build Status](https://travis-ci.org/sansible/mosquitto.svg?branch=develop)](https://travis-ci.org/sansible/mosquitto)

* [Installation and Dependencies](#installation-and-dependencies)
* [Tags](#tags)
* [Settings](#settings)
* [Examples](#examples)

This roles installs Mosquitto 1.4.x.

## Installation and Dependencies

This role has no dependencies.

To install run `ansible-galaxy install sansible.mosquitto` or add this to your
`roles.yml`

```YAML
- name: sansible.mosquitto
  version: v1.0
```

and run `ansible-galaxy install -p ./roles -r roles.yml`

## Tags

This role uses two tags: **build** and **configure**

* `build` - Installs Mosquitto.
* `configure` - Configures Mosquitto.

## Settings

```YAML
mosquitto:
  # Whether to install mosquitto_pub and _sub cmds
mosquitto_install_clients: false
mosquitto_version: 1.4.*
mosquitto_aws: yes
mosquitto_aws_region: eu-west-1
# List of files that need to be copied and secured from S3
# These should be things like TLS files
mosquitto_aws_files:
- bucket: config-bucket
 path: /mosquitto/tls/ca.crt
 dest: /etc/mosquitto/certs/ca.crt
 mode: "0600"
- bucket: config-bucket
 path: /mosquitto/tls/server.crt
 dest: /etc/mosquitto/certs/server.crt
 mode: "0600"
- bucket: config-bucket
 path: /mosquitto/tls/server.key
 dest: /etc/mosquitto/certs/server.key
 mode: "0600"
# All key/value pairs will be added to
# `/etc/mosquitto/conf.d/mosquitto.local.conf`
mosquitto_settings:
  allow_anonymous: "true"
  persistence: "true"
mosquitto_users:
  # Format is username: password, passwords must be generated using mosquitto_passwd
  # mosquitto_settings.password_file must be defined if you want to enable users
  user_one: hash
  user_two: hash

```

## Examples

To simply install Mosquitto:

```YAML
- name: Install Mosquitto
  hosts: sandbox

  roles:
    - name: sansible.mosquitto
```

Overriding some settings:

```YAML
- name: Install Mosquitto with alternate port
  hosts: sandbox

  roles:
    - name: sansible.mosquitto
      mosquitto_settings:
        port: 8000
```

To set up with a password file:

```YAML
- name: Install Mosquitto with username/password file
  hosts: sandbox

  roles:
    - name: sansible.mosquitto
      mosquitto_settings:
        allow_anonymous: "false"
        password_file: /etc/mosquitto/passwd
      mosquitto_users:
        user_one: hash
        user_two: hash
```
This will create a password file with the username/password hash mosquitto_users.
Note that the mosquitto_settings.password_file variable must be set.

Passwords should be hashes generated by the mosquitto_passwd utility
